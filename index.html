<!DOCTYPE html>
<meta charset="UTF-8"/>
<html>
<head>
    <style>
        body {
            padding: 0;
            margin: 0;
        }

        iframe {
            position:fixed;
            top:0px;
            left:0px;
            bottom:0px;
            right:0px;
            width:100%;
            height:100%;
            border:none;
            margin:0;
            padding:0;
            overflow:hidden;
            z-index:999999;
        }
    </style>
</head>
<body>
<iframe id="refreshgrafana" src="https://grafana.adeo.no/" height="0" width="0">
  Your browser doesn't support iframes
</iframe>
<iframe id="frame" src="" height="100%" width="100%">
  Your browser doesn't support iframes
</iframe>
<script type="text/javascript">
    let setUrlForHostname = (hostname, frame) => {
        return fetch('screenMap.json', {
            method: 'get'
        }).then(response => {
            return response.json();
        }).then(json => {
            frame.src = json[hostname];
        }).catch(err => {
            console.log(err);
        });
    };
    
    let refreshgrafana = () => {
         let grafanaframe = document.getElementById("refreshgrafana");
         console.log("grafana frame", grafanaframe);
         let ts = new Date().getTime(); // Just something that will change over time.
         let url = "https://grafana.adeo.no/" + '?forceCacheRefreshTs=' + ts;
         grafanaframe.src = url;
         console.log("grafana url", url);
    };

    let hostnameRegex = new RegExp("[?&]hostname=([^&]+)");
    let hostname = hostnameRegex.exec(window.location.href)[1];
    let frame = document.getElementById("frame");
    
    console.log(hostname);
    refreshgrafana();
    setInterval(refreshgrafana, 1000 * 60 * 1);

    setUrlForHostname(hostname, frame);
    setInterval(setUrlForHostname, 1000 * 60 * 1, hostname, frame);
</script>
</body>
</html>
